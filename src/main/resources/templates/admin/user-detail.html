<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User Details - Admin</title>
    <meta charset="UTF-8">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f7fa; }
        .navbar { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; padding: 15px 20px; }
        .navbar-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; }
        .navbar a { color: white; text-decoration: none; padding: 8px 16px; }
        .container { max-width: 1400px; margin: 30px auto; padding: 0 20px; }
        .back-btn { background: #dc2626; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none; display: inline-block; margin-bottom: 20px; }
        .user-info { background: white; padding: 30px; border-radius: 10px; margin-bottom: 25px; }
        .user-info h2 { color: #333; margin-bottom: 20px; }
        .info-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px; }
        .info-item { padding: 15px; background: #f5f7fa; border-radius: 8px; }
        .info-item label { color: #666; font-size: 12px; display: block; margin-bottom: 5px; }
        .info-item .value { font-size: 18px; font-weight: bold; color: #333; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px; }
        .stat-card { background: white; padding: 25px; border-radius: 10px; }
        .stat-card h3 { color: #666; font-size: 13px; margin-bottom: 10px; }
        .stat-card .value { font-size: 28px; font-weight: bold; color: #dc2626; }
        .positive { color: #4caf50 !important; }
        .negative { color: #f44336 !important; }
        .section { background: white; padding: 25px; border-radius: 10px; margin-bottom: 25px; }
        .section h3 { color: #333; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        th { background: #f5f7fa; color: #666; font-weight: 600; font-size: 12px; }
        .badge-buy { background: #4caf50; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; }
        .badge-sell { background: #f44336; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="navbar-content">
            <h1>üë®‚Äçüíº Admin Panel - User Management</h1>
            <div>
                <a href="/admin/dashboard">Dashboard</a>
                <a href="/admin/users">Manage Users</a>
                <a href="/logout">Logout</a>
            </div>
        </div>
    </div>
    
    <div class="container">
        <a href="/admin/users" class="back-btn">‚Üê Back to Users</a>
        
        <div class="user-info">
            <h2>User Details</h2>
            <div class="info-grid">
                <div class="info-item">
                    <label>Username</label>
                    <div class="value" th:text="${viewUser.username}"></div>
                </div>
                <div class="info-item">
                    <label>Full Name</label>
                    <div class="value" th:text="${viewUser.fullName}"></div>
                </div>
                <div class="info-item">
                    <label>Email</label>
                    <div class="value" th:text="${viewUser.email}"></div>
                </div>
                <div class="info-item">
                    <label>Joined</label>
                    <div class="value" th:text="${#temporals.format(viewUser.createdAt, 'MMM dd, yyyy')}"></div>
                </div>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Available Credits</h3>
                <div class="value">‚Çπ<span th:text="${#numbers.formatDecimal(viewUser.credits, 0, 'COMMA', 0, 'POINT')}"></span></div>
            </div>
            <div class="stat-card">
                <h3>Portfolio Value</h3>
                <div class="value">‚Çπ<span th:text="${#numbers.formatDecimal(totalValue, 0, 'COMMA', 2, 'POINT')}"></span></div>
            </div>
            <div class="stat-card">
                <h3>Total P/L</h3>
                <div class="value" th:classappend="${totalProfitLoss >= 0} ? 'positive' : 'negative'">
                    <span th:text="${totalProfitLoss >= 0 ? '+' : ''}"></span>‚Çπ<span th:text="${#numbers.formatDecimal(totalProfitLoss, 0, 'COMMA', 2, 'POINT')}"></span>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h3>Portfolio Holdings</h3>
            <div th:if="${#lists.isEmpty(portfolios)}" style="text-align: center; padding: 40px; color: #999;">
                No holdings
            </div>
            <table th:if="${!#lists.isEmpty(portfolios)}">
                <thead>
                    <tr>
                        <th>Stock</th>
                        <th>Quantity</th>
                        <th>Avg Buy Price</th>
                        <th>Current Price</th>
                        <th>Invested</th>
                        <th>Current Value</th>
                        <th>P/L</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="portfolio : ${portfolios}">
                        <td><strong th:text="${portfolio.stock.symbol}"></strong></td>
                        <td th:text="${portfolio.quantity}"></td>
                        <td>‚Çπ<span th:text="${#numbers.formatDecimal(portfolio.averageBuyPrice, 0, 2, 'POINT')}"></span></td>
                        <td>‚Çπ<span th:text="${#numbers.formatDecimal(portfolio.stock.currentPrice, 0, 2, 'POINT')}"></span></td>
                        <td>‚Çπ<span th:text="${#numbers.formatDecimal(portfolio.investedAmount, 0, 'COMMA', 2, 'POINT')}"></span></td>
                        <td>‚Çπ<span th:text="${#numbers.formatDecimal(portfolio.currentValue, 0, 'COMMA', 2, 'POINT')}"></span></td>
                        <td th:classappend="${portfolio.profitLoss >= 0} ? 'positive' : 'negative'">
                            <span th:text="${portfolio.profitLoss >= 0 ? '+' : ''}"></span>‚Çπ<span th:text="${#numbers.formatDecimal(portfolio.profitLoss, 0, 'COMMA', 2, 'POINT')}"></span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="section">
            <h3>Transaction History</h3>
            <div th:if="${#lists.isEmpty(transactions)}" style="text-align: center; padding: 40px; color: #999;">
                No transactions yet
            </div>
            <table th:if="${!#lists.isEmpty(transactions)}">
                <thead>
                    <tr>
                        <th>Date & Time</th>
                        <th>Type</th>
                        <th>Stock</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="transaction : ${transactions}">
                        <td th:text="${#temporals.format(transaction.transactionDate, 'MMM dd, yyyy HH:mm')}"></td>
                        <td>
                            <span th:class="${transaction.transactionType == 'BUY'} ? 'badge-buy' : 'badge-sell'" 
                                  th:text="${transaction.transactionType}"></span>
                        </td>
                        <td th:text="${transaction.stock.symbol}"></td>
                        <td th:text="${transaction.quantity}"></td>
                        <td>‚Çπ<span th:text="${#numbers.formatDecimal(transaction.pricePerShare, 0, 2, 'POINT')}"></span></td>
                        <td>‚Çπ<span th:text="${#numbers.formatDecimal(transaction.totalAmount, 0, 'COMMA', 2, 'POINT')}"></span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
